<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>MVM Nalbari - Smart Admit Card System</title>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background-color: #e0e0e0; margin: 0; padding: 20px; }
        .page-container { width: 210mm; margin: auto; }
        
        /* Admit Card Layout */
        .admit-card { 
            background: white; 
            padding: 40px; 
            margin-bottom: 30px; 
            border: 2px solid #000; 
            position: relative; 
            box-shadow: 0 0 10px rgba(0,0,0,0.2);
            page-break-after: always;
        }

        /* Watermark */
        .watermark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 400px;
            opacity: 0.08;
            pointer-events: none;
        }

        .header { text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; }
        .header h1 { margin: 0; font-size: 26px; color: #1a237e; text-transform: uppercase; }
        .header p { margin: 5px 0; font-weight: bold; font-size: 14px; }
        .exam-banner { background: #f0f0f0; padding: 5px; margin: 10px 0; font-weight: bold; border: 1px solid #ccc; }

        .main-content { display: flex; justify-content: space-between; margin-top: 20px; }
        .info-table { width: 75%; border-collapse: collapse; }
        .info-table td { padding: 8px 0; font-size: 15px; vertical-align: top; }
        .label { font-weight: bold; width: 140px; }

        .photo-box { 
            width: 140px; 
            height: 165px; 
            border: 1px solid #000; 
            text-align: center; 
            font-size: 11px; 
            background: #fafafa;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .photo-box img { width: 100%; height: 100%; object-fit: cover; }

        /* Exam Table */
        .exam-table { width: 100%; border-collapse: collapse; margin-top: 25px; }
        .exam-table th, .exam-table td { border: 1px solid #000; padding: 10px; text-align: center; font-size: 14px; }
        .exam-table th { background-color: #f9f9f9; }

        /* Signatures */
        .footer-sigs { display: flex; justify-content: space-between; margin-top: 50px; }
        .sig-box { width: 220px; text-align: center; border-top: 1px solid #000; padding-top: 5px; font-weight: bold; font-size: 13px; }
        .sig-box img { height: 45px; margin-bottom: -5px; }

        /* Instructions */
        .instructions { margin-top: 30px; font-size: 11px; line-height: 1.5; border-top: 1px solid #eee; padding-top: 15px; }
        .instructions h4 { margin: 0 0 5px 0; text-decoration: underline; }

        .barcode-svg { display: block; margin: 15px auto; }
        
        .no-print { text-align: center; margin-bottom: 20px; }
        .print-btn { padding: 12px 30px; background: #1a237e; color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; }

        @media print {
            body { background: none; padding: 0; }
            .no-print { display: none; }
            .admit-card { box-shadow: none; border: 1px solid #000; margin: 0; }
        }
    </style>
</head>
<body>

    <div class="no-print">
        <button class="print-btn" onclick="window.print()">Download & Print All Admit Cards</button>
    </div>

    <div id="admit-cards-wrapper" class="page-container">
        <p style="text-align:center;">Synchronizing with Google Sheet...</p>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyhkqZUTi4lGXOAqJJSrBwBJuYz8u3eBVAZGmybOeh6k5EaHMh2E4aMa7OMEHLRyqAczA/exec";

        async function fetchRecords() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                const container = document.getElementById('admit-cards-wrapper');
                container.innerHTML = '';

                data.forEach((student, index) => {
                    // Extracting keys dynamically from your sheet
                    const name = student["Student Name"] || "N/A";
                    const father = student["Father's Name"] || "N/A";
                    const id = student["Student ID"] || "000000";
                    const className = student["Class"] || "N/A";
                    const roll = student["Roll No"] || "N/A";
                    const photo = student["Photo"] || "";

                    const cardHtml = `
                        <div class="admit-card">
                            <img src="https://via.placeholder.com/400?text=MVM+LOGO" class="watermark">
                            
                            <div class="header">
                                <h1>Maharishi Vidya Mandir, Nalbari</h1>
                                <p>CBSE CURRICULUM â€¢ BATIRAM ROAD, NALBARI, PIN-781335</p>
                                <div class="exam-banner">ADMIT CARD: FINAL EXAMINATION 2025-2026</div>
                            </div>

                            <div class="main-content">
                                <table class="info-table">
                                    <tr><td class="label">Student Name</td><td>: ${name}</td></tr>
                                    <tr><td class="label">Father's Name</td><td>: ${father}</td></tr>
                                    <tr><td class="label">Student ID</td><td>: ${id}</td></tr>
                                    <tr><td class="label">Class / Roll No</td><td>: ${className} / ${roll}</td></tr>
                                </table>
                                <div class="photo-box">
                                    ${photo ? `<img src="${photo}">` : 'Affix Recent<br>Photograph'}
                                </div>
                            </div>

                            <table class="exam-table">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Subject / Paper</th>
                                        <th>Student's Sig.</th>
                                        <th>Invigilator's Sig.</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>${student["Date 1"] || ""}</td>
                                        <td>${student["Subject 1"] || ""}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>${student["Date 2"] || ""}</td>
                                        <td>${student["Subject 2"] || ""}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>${student["Date 3"] || ""}</td>
                                        <td>${student["Subject 3"] || ""}</td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </tbody>
                            </table>

                            <svg id="barcode-${index}" class="barcode-svg"></svg>

                            <div class="footer-sigs">
                                <div class="sig-box">Student's Signature</div>
                                <div class="sig-box">
                                    <img src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Jon_Kirsch_Signature.png"><br>
                                    Principal's Signature
                                </div>
                            </div>

                            <div class="instructions">
                                <h4>Instructions for Candidates</h4>
                                1. Carry this card daily. [span_4](start_span)Entry is prohibited without it[span_4](end_span). 
                                2. [span_5](start_span)Reach school 15 mins before time[span_5](end_span). 
                                3. [span_6](start_span)Gadgets like smart watches/phones are strictly prohibited[span_6](end_span). 
                                4. [span_7](start_span)Any misconduct leads to cancellation of candidature[span_7](end_span).
                            </div>
                        </div>
                    `;
                    container.innerHTML += cardHtml;
                });

                // Generate Barcodes after HTML is rendered
                data.forEach((student, index) => {
                    JsBarcode(`#barcode-${index}`, student["Student ID"] || "00000", {
                        format: "CODE128",
                        width: 1.8,
                        height: 40,
                        displayValue: true
                    });
                });

            } catch (error) {
                document.getElementById('admit-cards-wrapper').innerHTML = 
                    "<div style='color:red; text-align:center;'>Error: Could not connect to the API. Ensure your Web App is deployed as 'Anyone'.</div>";
            }
        }

        fetchRecords();
    </script>
</body>
</html>
